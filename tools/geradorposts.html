<script type="text/babel">
  const { useState, useMemo } = React;

  function PostGenerator() {
    const [title, setTitle] = useState("");
    const [category, setCategory] = useState("");
    const [tags, setTags] = useState("");
    const [content, setContent] = useState("");

    const [generatedMarkdown, setGeneratedMarkdown] = useState(null);

    // SLUG automático
    const slug = useMemo(() => {
      if (!title) return "";
      return title
        .toLowerCase()
        .replace(/[^a-z0-9\s-]/g, "")
        .trim()
        .replace(/[\s-]+/g, "-");
    }, [title]);

    // Tempo de leitura
    const readTime = useMemo(() => {
      if (!content) return "1 min";
      const words = content.split(/\s+/).length;
      const time = Math.ceil(words / 200);
      return `${time} min`;
    }, [content]);

    const handleSubmit = (e) => {
      e.preventDefault();

      const id = Date.now();
      const date = new Date().toISOString().split("T")[0];

      // Lista YAML das tags
      const yamlTags = tags
        .split(",")
        .map((t) => t.trim())
        .filter((t) => t.length > 0)
        .map((t) => `  - "${t}"`)
        .join("\n");

      // Gera o arquivo .md inteiro
      const markdown = `---
id: ${id}
slug: "${slug}"
title: "${title}"
date: "${date}"
category: "${category}"
tags:
${yamlTags}
readTime: "${readTime}"
---

${content}
`;

      setGeneratedMarkdown(markdown);
    };

    const handleDownload = () => {
      if (!generatedMarkdown) return;

      const blob = new Blob([generatedMarkdown], {
        type: "text/markdown",
      });

      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = `${slug}.md`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);

      URL.revokeObjectURL(url);
    };

    return (
      <div>
        <h1>Gerador de Posts</h1>

        <form className="form-grid" onSubmit={handleSubmit}>
          <div className="form-group">
            <label htmlFor="title">Título</label>
            <input
              id="title"
              type="text"
              value={title}
              onChange={(e) => setTitle(e.target.value)}
              required
            />
          </div>

          <div className="form-group-inline">
            <div className="form-group">
              <label htmlFor="category">Categoria</label>
              <input
                id="category"
                type="text"
                value={category}
                onChange={(e) => setCategory(e.target.value)}
                required
              />
            </div>

            <div className="form-group">
              <label htmlFor="tags">Tags</label>
              <input
                id="tags"
                type="text"
                value={tags}
                onChange={(e) => setTags(e.target.value)}
              />
              <small>Separe por vírgulas</small>
            </div>
          </div>

          <div className="form-group">
            <label htmlFor="content">Conteúdo (Markdown)</label>
            <textarea
              id="content"
              value={content}
              onChange={(e) => setContent(e.target.value)}
              required
            />
          </div>

          <button type="submit">Gerar Arquivo</button>
        </form>

        {generatedMarkdown && (
          <div style={{ marginTop: "2rem" }}>
            <h2>Arquivo Gerado</h2>
            <pre>
              <code>{generatedMarkdown}</code>
            </pre>

            <button onClick={handleDownload}>Baixar {slug}.md</button>
          </div>
        )}
      </div>
    );
  }

  const root = ReactDOM.createRoot(document.getElementById("root"));
  root.render(<PostGenerator />);
</script>
